<Window x:Class="RestaurantManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Sistem de gestiune restaurant" Height="620" Width="1100"
        WindowStartupLocation="CenterScreen">

    <DockPanel LastChildFill="True">

        <!-- BARĂ SUS -->
        <Grid DockPanel.Dock="Top" Margin="12,8,12,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Button Grid.Column="1"
                    Content="Deconectare"
                    Click="Logout_Click"
                    HorizontalAlignment="Right"
                    Padding="12,6"
                    MinWidth="120"/>
        </Grid>

        <!-- TABURI -->
        <TabControl x:Name="RootTabs" Margin="12">

            <!-- TAB 1: MENIU -->
            <TabItem x:Name="MenuTab" Header="Meniu">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Administrare meniu" FontSize="22" FontWeight="Bold"/>

                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2.3*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="1.7*"/>
                        </Grid.ColumnDefinitions>

                        <!-- LISTĂ PRODUSE (read-only) -->
                        <DockPanel Grid.Column="0">
                            <DataGrid DockPanel.Dock="Top"
                                      ItemsSource="{Binding Items}"
                                      SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      CanUserDeleteRows="False"
                                      IsReadOnly="True"
                                      Margin="0,0,0,8">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Nume"      Binding="{Binding Name}" Width="*"/>
                                    <DataGridTextColumn Header="Categorie" Binding="{Binding Category}" Width="180"/>
                                    <DataGridTextColumn Header="Preț"      Binding="{Binding Price, StringFormat={}{0:F2}}" Width="80"/>
                                    <DataGridCheckBoxColumn Header="Disponibil" Binding="{Binding IsAvailable}" Width="90" IsReadOnly="True"/>
                                </DataGrid.Columns>
                                <DataGrid.RowStyle>
                                    <Style TargetType="DataGridRow">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsAvailable}" Value="False">
                                                <Setter Property="Foreground" Value="Gray"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGrid.RowStyle>
                            </DataGrid>

                            <WrapPanel DockPanel.Dock="Bottom" Margin="0,8,0,0">
                                <Button Content="Modifică selectatul"
                                        Command="{Binding StartEditCommand}"
                                        Width="150" Margin="0,0,8,0"/>
                                <Button Content="Dezactivează selectatul"
                                        Command="{Binding DeactivateCommand}"
                                        Width="170"/>
                            </WrapPanel>
                        </DockPanel>

                        <!-- FORM ADĂUGARE -->
                        <DockPanel Grid.Column="2">
                            <StackPanel DockPanel.Dock="Top">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>

                                <TextBlock Text="Adaugă produs" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Nume" Width="90" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding NewItem.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="220"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Categorie" Width="90" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding NewItem.Category, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="220"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Preț" Width="90" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding NewItem.Price, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="Disponibil" Width="90" VerticalAlignment="Center"/>
                                    <CheckBox IsChecked="{Binding NewItem.IsAvailable, Mode=TwoWay}"/>
                                </StackPanel>

                                <WrapPanel>
                                    <Button Content="Adaugă" Command="{Binding AddCommand}" Width="100"/>
                                </WrapPanel>
                            </StackPanel>

                            <!-- FORM EDITARE -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>

                                <TextBlock Text="Modifică produs" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Nume" Width="90" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding EditItem.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="220"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Categorie" Width="90" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding EditItem.Category, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="220"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Preț" Width="90" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding EditItem.Price, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="Disponibil" Width="90" VerticalAlignment="Center"/>
                                    <CheckBox IsChecked="{Binding EditItem.IsAvailable, Mode=TwoWay}"/>
                                </StackPanel>

                                <WrapPanel>
                                    <Button Content="Salvează modificările" Command="{Binding SaveEditCommand}" Width="170" Margin="0,0,8,0"/>
                                    <Button Content="Anulează" Command="{Binding CancelEditCommand}" Width="100"/>
                                </WrapPanel>
                            </StackPanel>
                        </DockPanel>
                    </Grid>
                </Grid>
            </TabItem>

            <!-- TAB 2: COMENZI -->
            <TabItem x:Name="OrdersTab" Header="Comenzi">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="0.9*"/>
                        <ColumnDefinition Width="2.0*"/>
                        <ColumnDefinition Width="2.6*"/>
                    </Grid.ColumnDefinitions>

                    <!-- MESE -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Mese" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <ListBox Grid.Row="1"
                                 ItemsSource="{Binding Tables}"
                                 SelectedItem="{Binding SelectedTable, Mode=TwoWay}"
                                 DisplayMemberPath="Name"/>
                    </Grid>

                    <!-- MENIU + CĂUTARE -->
                    <Grid Grid.Column="1" Margin="12,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Caută:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBox Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}" Width="220"/>
                        </StackPanel>

                        <ListView Grid.Row="1" x:Name="MenuList"
                                  ItemsSource="{Binding MenuView}"
                                  ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Produs" Width="220" DisplayMemberBinding="{Binding Name}"/>
                                    <GridViewColumn Header="Categorie" Width="150" DisplayMemberBinding="{Binding Category}"/>
                                    <GridViewColumn Header="Preț" Width="80" DisplayMemberBinding="{Binding Price, StringFormat={}{0:F2}}"/>
                                    <GridViewColumn Header="" Width="60">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Content="+"
                                                        Command="{Binding DataContext.AddItemCommand, ElementName=OrdersTab}"
                                                        CommandParameter="{Binding}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>

                        <Button Grid.Row="2" Content="Adaugă (+)"
                                Margin="0,8,0,0"
                                Width="120"
                                HorizontalAlignment="Left"
                                Command="{Binding AddItemCommand}"
                                CommandParameter="{Binding SelectedItem, ElementName=MenuList}"/>
                    </Grid>

                    <!-- COMANDA CURENTĂ -->
                    <DockPanel Grid.Column="2">
                        <TextBlock DockPanel.Dock="Top" Text="Comanda curentă" FontWeight="SemiBold" Margin="0,0,0,8"/>

                        <StackPanel DockPanel.Dock="Bottom" Margin="0,8,0,0">
                            <WrapPanel Margin="0,0,0,6">
                                <Button Content="+1" Command="{Binding IncreaseQtyCommand}" Width="50" Margin="0,0,6,0"/>
                                <Button Content="-1" Command="{Binding DecreaseQtyCommand}" Width="50" Margin="0,0,6,0"/>
                                <Button Content="Șterge" Command="{Binding RemoveItemCommand}" Width="80"/>
                            </WrapPanel>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,6">
                                <TextBlock Text="Total:" FontSize="16" FontWeight="SemiBold" Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding Total, StringFormat={}{0:F2} lei}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>

                            <Button Content="Încasează (Plătit)" Command="{Binding PayCommand}" Height="36" HorizontalAlignment="Right" Width="180"/>

                            <Separator Margin="0,8,0,8"/>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <TextBlock Text="Încasări azi:" Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding RevenueToday, StringFormat={}{0:F2} lei}" FontWeight="Bold" Margin="0,0,16,0"/>
                                <TextBlock Text="Încasări totale:" Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding RevenueAllTime, StringFormat={}{0:F2} lei}" FontWeight="Bold" Margin="0,0,16,0"/>
                                <Button Content="Reîmprospătează" Command="{Binding RefreshRevenueCommand}" Width="130"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- FIX: ItemsSource legat din nou -->
                        <DataGrid ItemsSource="{Binding CurrentItems}"
                                  SelectedItem="{Binding SelectedOrderItem, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Produs" Binding="{Binding MenuItem.Name}" Width="*" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Cant."  Binding="{Binding Quantity}" Width="60"  IsReadOnly="True"/>
                                <DataGridTextColumn Header="Preț"   Binding="{Binding UnitPrice, StringFormat={}{0:F2}}" Width="80" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Subtotal" Binding="{Binding Subtotal, StringFormat={}{0:F2}}" Width="90" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </Grid>
            </TabItem>

            <!-- TAB 3: UTILIZATORI -->
            <TabItem x:Name="UsersTab" Header="Utilizatori">
                <Grid x:Name="UsersRoot" Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="1.4*"/>
                    </Grid.ColumnDefinitions>

                    <DockPanel Grid.Column="0">
                        <DataGrid DockPanel.Dock="Top"
                                  ItemsSource="{Binding Users}"
                                  SelectedItem="{Binding SelectedUser, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  IsReadOnly="True"
                                  Margin="0,0,0,8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="*"/>
                                <DataGridTextColumn Header="Rol"      Binding="{Binding Role}" Width="140"/>
                                <DataGridCheckBoxColumn Header="Activ" Binding="{Binding IsActive}" Width="70" IsReadOnly="True"/>
                            </DataGrid.Columns>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsActive}" Value="False">
                                            <Setter Property="Foreground" Value="Gray"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                        </DataGrid>

                        <WrapPanel DockPanel.Dock="Bottom" Margin="0,8,0,0">
                            <Button Content="Modifică selectatul"
                                    Command="{Binding StartEditCommand}"
                                    Width="150" Margin="0,0,8,0"/>
                            <Button Content="Dezactivează selectatul"
                                    Command="{Binding DeactivateCommand}"
                                    Width="170"/>
                        </WrapPanel>
                    </DockPanel>

                    <StackPanel Grid.Column="2">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Adaugă utilizator" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Username" Width="90" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding NewUser.Username, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Rol" Width="90" VerticalAlignment="Center"/>
                            <ComboBox ItemsSource="{Binding Roles}" SelectedItem="{Binding NewUser.Role, Mode=TwoWay}" Width="150"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Parolă" Width="90" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding NewUser.Password, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Text="Activ" Width="90" VerticalAlignment="Center"/>
                            <CheckBox IsChecked="{Binding NewUser.IsActive, Mode=TwoWay}"/>
                        </StackPanel>

                        <WrapPanel>
                            <Button Content="Adaugă" Command="{Binding AddCommand}" Width="100"/>
                        </WrapPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="2">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Modifică utilizator" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Username" Width="90" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding EditUser.Username, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Rol" Width="90" VerticalAlignment="Center"/>
                            <ComboBox ItemsSource="{Binding Roles}" SelectedItem="{Binding EditUser.Role, Mode=TwoWay}" Width="150"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Parolă (lasă gol pt. neschimbat)" Width="190" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding EditUser.Password, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Text="Activ" Width="90" VerticalAlignment="Center"/>
                            <CheckBox IsChecked="{Binding EditUser.IsActive, Mode=TwoWay}"/>
                        </StackPanel>

                        <WrapPanel>
                            <Button Content="Salvează modificările" Command="{Binding SaveEditCommand}" Width="170" Margin="0,0,8,0"/>
                            <Button Content="Anulează" Command="{Binding CancelEditCommand}" Width="100"/>
                        </WrapPanel>
                    </StackPanel>
                </Grid>
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
